<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>Call vs DelegateCall in Solidity &mdash; Tuhalang</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tuhalang/tuhalang.github.io@master/assets/vendor/primer-css/css/primer.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tuhalang/tuhalang.github.io@master/assets/css/components/collection.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tuhalang/tuhalang.github.io@master/assets/css/components/repo-card.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tuhalang/tuhalang.github.io@master/assets/css/sections/repo-list.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tuhalang/tuhalang.github.io@master/assets/css/components/boxed-group.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tuhalang/tuhalang.github.io@master/assets/css/globals/common.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tuhalang/tuhalang.github.io@master/assets/css/globals/responsive.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tuhalang/tuhalang.github.io@master/assets/css/posts/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tuhalang/tuhalang.github.io@master/assets/vendor/octicons/octicons/octicons.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mzlogin/rouge-themes@master/dist/github.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tuhalang/tuhalang.github.io@master/assets/vendor/share.js/dist/css/share.min.css"><link rel="canonical" href="https://tuhalang.github.io/2022/04/06/Call-vs-Delegate-Call/"><link rel="alternate" type="application/atom+xml" title="Tuhalang" href="https://tuhalang.github.io/feed.xml"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/tuhalang/tuhalang.github.io@master/favicon.ico"><meta property="og:title" content="Call vs DelegateCall in Solidity"><meta name="keywords" content="Smartcontract, Blockchain, Solidity, Call, DelegateCall"><meta name="og:keywords" content="Smartcontract, Blockchain, Solidity, Call, DelegateCall"><meta name="description" content="In Solidity, when you want to call other contracts, you can use call or delegateCall functions. So, what are different between call and delegateCall?"><meta name="og:description" content="In Solidity, when you want to call other contracts, you can use call or delegateCall functions. So, what are different between call and delegateCall?"><meta property="og:url" content="https://tuhalang.github.io/2022/04/06/Call-vs-Delegate-Call/"><meta property="og:site_name" content="Tuhalang"><meta property="og:type" content="article"><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2022-04-06"> <script src="https://cdn.jsdelivr.net/gh/tuhalang/tuhalang.github.io@master/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/tuhalang/tuhalang.github.io@master/assets/js/jquery-ui.js"></script> <script src="https://cdn.jsdelivr.net/gh/tuhalang/tuhalang.github.io@master/assets/js/main.js"></script> <script data-ad-client="ca-pub-7093222719567591" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-161740789-1"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-161740789-1'); </script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1><a href="https://tuhalang.github.io/" title="Tuhalang"><span class="octicon octicon-mark-github"></span> Tuhalang</a></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="https://tuhalang.github.io/" class=" site-header-nav-item" target="" title="Home">Home</a> <a href="https://tuhalang.github.io/categories/" class=" site-header-nav-item" target="" title="Categories">Categories</a> <a href="https://tuhalang.github.io/archives/" class=" site-header-nav-item" target="" title="Archives">Archives</a> <a href="https://tuhalang.github.io/wiki/" class=" site-header-nav-item" target="" title="Wiki">Wiki</a> <a href="https://tuhalang.github.io/about/" class=" site-header-nav-item" target="" title="About">About</a></nav></div></header><section class="collection-head small geopattern" data-pattern-id="Call vs Delegat"><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">Call vs DelegateCall in Solidity</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2022/04/06 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://tuhalang.github.io/categories/#Smartcontract" title="Smartcontract">Smartcontract</a> </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://tuhalang.github.io/categories/#Blockchain" title="Blockchain">Blockchain</a> </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://tuhalang.github.io/categories/#Solidity" title="Solidity">Solidity</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> Common 1680 words，about 5 minutes </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths" ><article class="article-content markdown-body"><p>In Solidity, when you want to call other contracts, you can use <strong>call</strong> or <strong>delegateCall</strong> functions. So, what are different between <strong>call</strong> and <strong>delegateCall</strong>?</p><h3 id="call-vs-delegatecall">Call vs DelegateCall</h3><ul><li><p>The main difference between them is that while call just executes the function in the context of the contract it was defined, delegatecall inherits the execution context, meaning that the function will behave as it was defined in the contract that’s using delegatecall.</p></li><li><p>For example:</p><ul><li>Call:</li></ul><p><img src="https://tuhalang.github.io/assets/call_delegate_call/call_diagram.svg" alt="call_function" /></p><ul><li>DelegateCall:</li></ul><p><img src="https://tuhalang.github.io/assets/call_delegate_call/delegate_call_diagram.svg" alt="deletage_call_function" /></p></li></ul><div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SPDX-License-Identifier: MIT
</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">10</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">Reciever</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="n">z</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="n">y</span><span class="p">;</span>

    <span class="k">function</span> <span class="n">setX</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_x</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">_x</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">setY</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_y</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">_y</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">contract</span> <span class="n">Caller</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="n">x</span><span class="p">;</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="n">y</span><span class="p">;</span>

    <span class="k">function</span> <span class="n">useCall</span><span class="p">(</span><span class="kt">address</span> <span class="n">_contract</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_x</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_y</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="p">(</span><span class="kt">bool</span> <span class="n">successX</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">_contract</span><span class="p">.</span><span class="nb">call</span><span class="p">(</span>
            <span class="n">abi</span><span class="p">.</span><span class="n">encodeWithSignature</span><span class="p">(</span><span class="s">"setX(uint256)"</span><span class="p">,</span> <span class="n">_x</span><span class="p">)</span>
        <span class="p">);</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">successX</span><span class="p">,</span> <span class="s">"Error"</span><span class="p">);</span>

        <span class="p">(</span><span class="kt">bool</span> <span class="n">successY</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">_contract</span><span class="p">.</span><span class="nb">call</span><span class="p">(</span>
            <span class="n">abi</span><span class="p">.</span><span class="n">encodeWithSignature</span><span class="p">(</span><span class="s">"setY(uint256)"</span><span class="p">,</span> <span class="n">_y</span><span class="p">)</span>
        <span class="p">);</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">successY</span><span class="p">,</span> <span class="s">"Error"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">useDelegateCall</span><span class="p">(</span><span class="kt">address</span> <span class="n">_contract</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_x</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_y</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
        <span class="p">(</span><span class="kt">bool</span> <span class="n">successX</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">_contract</span><span class="p">.</span><span class="n">delegateCall</span><span class="p">(</span>
            <span class="n">abi</span><span class="p">.</span><span class="n">encodeWithSignature</span><span class="p">(</span><span class="s">"setX(uint256)"</span><span class="p">,</span> <span class="n">_x</span><span class="p">)</span>
        <span class="p">);</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">successX</span><span class="p">,</span> <span class="s">"Error"</span><span class="p">);</span>

        <span class="p">(</span><span class="kt">bool</span> <span class="n">successY</span><span class="p">,</span> <span class="p">)</span> <span class="o">=</span> <span class="n">_contract</span><span class="p">.</span><span class="n">delegateCall</span><span class="p">(</span>
            <span class="n">abi</span><span class="p">.</span><span class="n">encodeWithSignature</span><span class="p">(</span><span class="s">"setY(uint256)"</span><span class="p">,</span> <span class="n">_y</span><span class="p">)</span>
        <span class="p">);</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">successY</span><span class="p">,</span> <span class="s">"Error"</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div><ul><li>If you call function <strong><em>useCall()</em></strong>, the value of x and y vatiables in Recevier contract will be changed.</li><li>If you call function <strong><em>useDelegateCall()</em></strong>, the value of x variable and storage in slot 2 in Caller contract will be change.</li><li><p>Why not the variable y but the storage in slot 2?</p><ul><li>Look back a bit on the layout of storage in solidity, variables will be stored in slots 0, 1, 2, … respectively.</li><li>Because the variable y in Reciever contract is stored in slot 2, when using delegateCall to call, the corresponding variable stored in slot 2 of Caller contract will be changed.</li></ul></li></ul><p><strong><em>You need to be really careful with storing conflicts when using delegateCall.</em></strong></p><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>Document Information</h3><ul><li>Author of this article:<a href="https://tuhalang.github.io" target="_blank">Tuhalang</a></li><li>Link to this article:<a href="https://tuhalang.github.io/2022/04/06/Call-vs-Delegate-Call/" target="_blank">https://tuhalang.github.io/2022/04/06/Call-vs-Delegate-Call/</a></li><li>Copyright statement: free reprint - non-commercial - non-derivative - keep attribution（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">Creative Commons 3.0 License</a>）</li></ul></div></article><div class="share"><div class="share-component" data-disabled='qq,weibo,wechat,douban,qzone'></div></div><div class="comment"><div id="gitalk-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tuhalang/tuhalang.github.io@master/assets/vendor/gitalk/gitalk.css"> <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> <script> var gitalk = new Gitalk({ id: '/2022/04/06/Call-vs-Delegate-Call/', clientID: 'ee780ad580c724383fc9', clientSecret: 'b27916ae861218d97f817647e98288467e8f1ed0', repo: 'blog-comments', owner: 'tuhalang', admin: ['tuhalang'], labels: ['gitment'], perPage: 50, }); gitalk.render('gitalk-container'); </script></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"></div><ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul><script src="https://cdn.jsdelivr.net/gh/tuhalang/tuhalang.github.io@master/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: 'https://cdn.jsdelivr.net/gh/tuhalang/tuhalang.github.io@built/assets/search_data.json?v=1660291560', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="https://cdn.jsdelivr.net/gh/tuhalang/tuhalang.github.io@master/assets/js/jquery.toc.js"></script> <ins class="adsbygoogle" style="display:inline-block;width:300px;height:250px" data-ad-client="ca-pub-7093222719567591" data-ad-slot="2908164598"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script></div></div></section><footer class="container"> <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-7093222719567591" data-ad-slot="5263168187" data-ad-format="auto" data-full-width-responsive="true"></ins> <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2022 <span title="Tuhalang">Tuhalang</span> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo(0,0)" >TOP</a></li></ul><a href="https://github.com/tuhalang/tuhalang.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="https://tuhalang.github.io/" title="Home" target="">Home</a></li><li> <a href="https://tuhalang.github.io/categories/" title="Categories" target="">Categories</a></li><li> <a href="https://tuhalang.github.io/archives/" title="Archives" target="">Archives</a></li><li> <a href="https://tuhalang.github.io/wiki/" title="Wiki" target="">Wiki</a></li><li> <a href="https://tuhalang.github.io/about/" title="About" target="">About</a></li><li><a href="https://tuhalang.github.io/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="https://cdn.jsdelivr.net/gh/tuhalang/tuhalang.github.io@master/assets/vendor/share.js/dist/js/share.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/tuhalang/tuhalang.github.io@master/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script></body></html>
